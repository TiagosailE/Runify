<div class="min-h-screen bg-[#F5F5F5] dark:bg-[#1a1a1a] pb-24">
  
  <%= render 'shared/header' %>

  <style>
    @keyframes pulse-frame {
      0%, 100% { opacity: 0.8; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.02); }
    }

    @keyframes rotate-frame {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @keyframes glow-pulse {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3); }
    }

    .frame-container {
      position: relative;
      display: inline-block;
    }

    .frame-border {
      position: absolute;
      top: -8px;
      left: -8px;
      right: -8px;
      bottom: -8px;
      pointer-events: none;
    }

    .frame-icon {
      position: absolute;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      z-index: 10;
    }

    .tier-challenger .frame-border {
      animation: rotate-frame 4s linear infinite, glow-pulse 2s ease-in-out infinite;
    }

    .tier-grandmaster .frame-border {
      animation: pulse-frame 2s ease-in-out infinite;
    }

    .tier-master .frame-border {
      animation: pulse-frame 2.5s ease-in-out infinite;
    }

    .corner-tl { top: -8px; left: -8px; }
    .corner-tr { top: -8px; right: -8px; }
    .corner-bl { bottom: -8px; left: -8px; }
    .corner-br { bottom: -8px; right: -8px; }
  </style>

  <main class="px-6 py-6 space-y-6">
    
    <section>
      <div class="bg-gradient-to-r from-teal-500 to-teal-600 rounded-2xl p-6 text-white shadow-lg">
        <h2 class="text-2xl font-bold mb-2"><%= @squad.name %></h2>
        <% if @squad.description.present? %>
          <p class="text-sm opacity-90 mb-3"><%= @squad.description %></p>
        <% end %>
        
        <div class="flex items-center gap-4 text-sm">
          <span><i class="fas fa-users mr-1"></i><%= @squad.users.count %> membros</span>
          <% if @squad.challenge_end %>
            <span><i class="fas fa-calendar mr-1"></i>Termina <%= @squad.challenge_end.strftime('%d/%m/%Y') %></span>
          <% else %>
            <span><i class="fas fa-infinity mr-1"></i>Infinito</span>
          <% end %>
        </div>

        <div class="mt-4 pt-4 border-t border-white/20">
          <p class="text-xs opacity-75 mb-2">Código do Pacer</p>
          <div class="flex items-center gap-2">
            <code class="bg-white/20 px-4 py-2 rounded-lg font-mono text-lg font-bold tracking-wider"><%= @squad.squad_code %></code>
            <button onclick="window.copyToClipboard('<%= @squad.squad_code %>', 'Código copiado!')" class="bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg transition-all">
            <i class="fas fa-copy"></i>
            </button>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">
        <i class="fas fa-trophy text-[#FF6A3D] mr-2"></i>
        Ranking
      </h3>

      <div class="space-y-3">
        <% @leaderboard.each_with_index do |member, index| %>
          <div class="relative bg-white dark:bg-[#2d3748] rounded-2xl p-5 shadow-sm <%= 'ring-2 ring-teal-500' if member.user == current_user %>">
            
            <% if index < 3 %>
              <div class="absolute top-3 left-3">
                <% medal_colors = ['#FFD700', '#C0C0C0', '#CD7F32'] %>
                <div class="w-8 h-8 rounded-full flex items-center justify-center" style="background: <%= medal_colors[index] %>">
                  <span class="text-white font-bold text-sm"><%= index + 1 %>º</span>
                </div>
              </div>
            <% else %>
              <div class="absolute top-3 left-3">
                <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                  <span class="text-gray-600 dark:text-gray-400 font-bold text-sm"><%= index + 1 %>º</span>
                </div>
              </div>
            <% end %>

            <div class="flex items-center gap-4 ml-10">
              
              <div class="frame-container tier-<%= member.border_tier %>">
                
                <svg class="frame-border" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                  <defs>
                    <filter id="glow-<%= member.user.id %>">
                      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                      <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                      </feMerge>
                    </filter>
                  </defs>
                  
                  <circle cx="50" cy="50" r="45" fill="none" stroke="<%= member.border_color %>" stroke-width="3" opacity="0.3"/>
                  <circle cx="50" cy="50" r="48" fill="none" stroke="<%= member.border_color %>" stroke-width="2" filter="url(#glow-<%= member.user.id %>)" style="box-shadow: <%= member.border_glow %>"/>
                  
                  <path d="M 50,5 L 55,15 L 45,15 Z" fill="<%= member.border_color %>" filter="url(#glow-<%= member.user.id %>)"/>
                  <path d="M 95,50 L 85,55 L 85,45 Z" fill="<%= member.border_color %>" filter="url(#glow-<%= member.user.id %>)"/>
                  <path d="M 50,95 L 55,85 L 45,85 Z" fill="<%= member.border_color %>" filter="url(#glow-<%= member.user.id %>)"/>
                  <path d="M 5,50 L 15,55 L 15,45 Z" fill="<%= member.border_color %>" filter="url(#glow-<%= member.user.id %>)"/>
                  
                  <% if member.level >= 30 %>
                    <path d="M 20,20 L 25,15 L 15,25 Z" fill="<%= member.border_color %>" opacity="0.7"/>
                    <path d="M 80,20 L 75,15 L 85,25 Z" fill="<%= member.border_color %>" opacity="0.7"/>
                    <path d="M 20,80 L 25,85 L 15,75 Z" fill="<%= member.border_color %>" opacity="0.7"/>
                    <path d="M 80,80 L 75,85 L 85,75 Z" fill="<%= member.border_color %>" opacity="0.7"/>
                  <% end %>
                </svg>

                <div class="w-20 h-20 rounded-full overflow-hidden border-2" style="border-color: <%= member.border_color %>; box-shadow: <%= member.border_glow %>">
                  <img src="<%= member.user.avatar_url %>" alt="<%= member.user.username %>" class="w-full h-full object-cover">
                </div>

                <% if member.level >= 10 %>
                  <div class="frame-icon corner-tl" style="color: <%= member.border_color %>">
                    <i class="fas <%= member.tier_icon %>"></i>
                  </div>
                  <div class="frame-icon corner-tr" style="color: <%= member.border_color %>">
                    <i class="fas <%= member.tier_icon %>"></i>
                  </div>
                <% end %>

                <div class="absolute -bottom-1 -right-1 text-white text-xs font-bold rounded-full w-8 h-8 flex items-center justify-center border-3 border-white dark:border-gray-800 shadow-lg" style="background: <%= member.border_color %>; box-shadow: <%= member.border_glow %>">
                  <%= member.level %>
                </div>
              </div>

              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <h4 class="font-bold text-gray-900 dark:text-white">
                    <%= member.user.username %>
                  </h4>
                  <% if member.user == current_user %>
                    <span class="text-xs bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 px-2 py-0.5 rounded-full font-medium">Você</span>
                  <% end %>
                </div>
                <p class="text-sm font-semibold <%= member.rank_color_class %>">
                  <i class="fas <%= member.tier_icon %> mr-1"></i><%= member.rank_title %>
                </p>
                
                <div class="mt-2 flex items-center gap-2">
                  <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden">
                    <div class="h-2 rounded-full transition-all" style="width: <%= member.xp_progress_percentage %>%; background: <%= member.border_color %>; box-shadow: 0 0 10px <%= member.border_color %>"></div>
                  </div>
                  <span class="text-xs text-gray-500 dark:text-gray-400 font-medium"><%= member.xp_progress_percentage %>%</span>
                </div>
              </div>

              <div class="text-right">
                <p class="text-2xl font-bold text-gray-900 dark:text-white"><%= member.experience_points %></p>
                <p class="text-xs text-gray-500 dark:text-gray-400">XP</p>
                <% if member.streak > 0 %>
                  <div class="mt-1 inline-flex items-center gap-1 bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 px-2 py-0.5 rounded-full">
                    <i class="fas fa-fire text-xs"></i>
                    <span class="text-xs font-bold"><%= member.streak %></span>
                  </div>
                <% end %>
              </div>

            </div>
          </div>
        <% end %>
      </div>
    </section>

    <% if @squad.owner == current_user %>
      <section>
        <div class="bg-gradient-to-r from-yellow-400 to-yellow-500 rounded-2xl p-4 text-white shadow-lg">
          <div class="flex items-center gap-2">
            <i class="fas fa-shield-alt text-2xl"></i>
            <p class="font-semibold">Você é o administrador deste Pacer</p>
          </div>
        </div>
      </section>
    <% else %>
      <%= button_to "Sair do Pacer", leave_pacer_path(@squad), 
          method: :delete,
          data: { confirm: 'Tem certeza que deseja sair deste Pacer?' },
          class: "w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-4 px-4 rounded-2xl transition-all shadow-lg" %>
    <% end %>

  </main>

  <%= render 'shared/footer' %>

</div>